<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Zend Opcache-JSON</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>opcache-json</h1>
        <h2>zend optimizer stats via json/statsd</h2>
        <a href="https://github.com/stevencorona/opcache-json" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="opcache-json" class="anchor" href="#opcache-json"><span class="octicon octicon-link"></span></a>opcache-json</h1>

<p>PHP 5.5 is awesome. It's fast, more modern, and has a bunch of great features. One of those new, awesome features is that it gets bundled with
Zend Opcache by default— no more APC! Hooray!</p>

<p>But this win brings some new burden. Zend Opcache has a TON of configuration settings and monitoring them is not that easy. The default output is a
little bit clunky and wasn't really designed with modern devops in mind.</p>

<h2>Designed for Modern Devops</h2>
<p>This library was designed to solve that problem. It cleans up Zend Opcache's internal stats and makes it easily grabbable as JSON, which your app can choose
to expose to an internal HTTP endpoint. Opcache-json also exposes this data to statsd, which you can use to view historical cache data and watch trends.</p>

<h2>Getting Started</h2>
The best way to install it is to use Composer and add the following to your project's <code>composer.json</code> file:

<div class="highlight"><pre>
{
    "require": {
        "stevencorona/opcache-json": "*"
    }
}
</pre></div>

<h2>Basic Usage</h2>
<div class="highlight"><pre>
// By default Statsd output is disabled
// $opcache = new Opcache\Status;

// Or pass in Statsd config with an array
// $opcache = new Opcache\Status(["host" => "localhost", "port" => "8125"]);

// Or configure the Statsd connection with a block
$opcache = new Opcache\Status(function() {

  $c   = new \Domnikl\Statsd\Connection\Socket("127.0.0.1", "8125");
  return new \Domnikl\Statsd\Client($c, "opcache");

});

echo $opcache->status(true);
</pre></div>

<h2>Statsd Output</h2>
<p>Statsd output comes stock. Just configure your connection by passing a block or an array to the <code>Opcache\Status</code> constructor. The following keys are sent as gauge values to Statsd:
<div class="highlight"><pre>
opcache.used_memory:5593056|g
opcache.free_memory:61515808|g
opcache.wasted_memory:0|g
opcache.current_wasted_percentage:0|g
opcache.num_cached_scripts:11|g
opcache.num_cached_keys:13|g
opcache.max_cached_keys:3907|g
opcache.hits:33|g
opcache.start_time:1396011952|g
opcache.last_restart_time:0|g
opcache.oom_restarts:0|g
opcache.hash_restarts:0|g
opcache.manual_restarts:0|g
opcache.misses:11|g
opcache.blacklist_misses:0|g
opcache.blacklist_miss_ratio:0|g
opcache.opcache_hit_rate:75|g
</pre></div>

<p>If you have a multi-server or multi-worker environment (hint: most of us do), you probably want to add your server hostname and PHP PID to the key namespace.</p>


<h2>JSON Output</h2>
<p>The JSON output is easy to ready and can be exposed as an internal HTTP endpoint, which can be consumed by human eyes or a monitoring systems. It's
  pretty straightforward— the output looks like this</p>

<img src="images/screenshot.png">


        </section>

        <aside id="sidebar">
          <a href="https://github.com/stevencorona/opcache-json/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/stevencorona/opcache-json/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/stevencorona/opcache-json"></a> is maintained by <a href="https://github.com/stevencorona">stevencorona</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>


  </body>
</html>
